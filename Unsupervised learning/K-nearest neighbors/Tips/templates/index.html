<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Restaurant Tip Predictor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Plotly CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #0f172a;
            margin: 0;
            padding: 0;
            color: #e5e7eb;
        }

        .container {
            max-width: 900px;
            margin: 40px auto;
            background: #020617;
            border-radius: 18px;
            padding: 24px 28px 32px;
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid #1f2937;
        }

        h1 {
            margin: 0;
            text-align: center;
            font-size: 1.9rem;
        }

        .subtitle {
            text-align: center;
            color: #9ca3af;
            margin-top: 6px;
            margin-bottom: 22px;
            font-size: 0.95rem;
        }

        form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 16px 24px;
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        label {
            font-size: 0.9rem;
            color: #e5e7eb;
            font-weight: 500;
        }

        input[type="number"],
        select {
            border-radius: 10px;
            border: 1px solid #374151;
            background: #020617;
            color: #e5e7eb;
            padding: 8px 10px;
            font-size: 0.95rem;
            box-sizing: border-box;
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 1px #6366f1;
        }

        .hint {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .buttons-row {
            grid-column: 1 / -1;
            margin-top: 4px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        button {
            border-radius: 999px;
            border: none;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            padding: 9px 18px;
        }

        .btn-primary {
            background: #6366f1;
            color: white;
        }

        .btn-primary:hover {
            background: #4f46e5;
        }

        .btn-secondary {
            background: #111827;
            color: #e5e7eb;
            border: 1px solid #374151;
        }

        .btn-secondary:hover {
            background: #1f2937;
        }

        .result-section {
            margin-top: 22px;
        }

        .section-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.09em;
            color: #9ca3af;
        }

        .result-card {
            margin-top: 10px;
            padding: 14px 16px;
            border-radius: 14px;
            background: #020617;
            border: 1px solid #1f2937;
        }

        .tip-pill {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 0.95rem;
            font-weight: 600;
            background: rgba(56, 189, 248, 0.18);
            border: 1px solid rgba(59, 130, 246, 0.65);
            color: #bfdbfe;
            gap: 8px;
        }

        .tip-number {
            font-size: 1.1rem;
        }

        .note {
            margin-top: 8px;
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .plot-container {
            margin-top: 16px;
        }

        @media (max-width: 640px) {
            .container {
                margin: 18px;
                padding: 20px 18px 24px;
            }
        }
    </style>

    <script>
        function fillBusyTable() {
            document.getElementById("total_bill").value = 300;
            document.getElementById("sex").value = "Female";
            document.getElementById("smoker").value = "No";
            document.getElementById("day").value = "Fri";
            document.getElementById("time").value = "Dinner";
            document.getElementById("size").value = 10;
        }

        function fillSimpleExample() {
            document.getElementById("total_bill").value = 50;
            document.getElementById("sex").value = "Male";
            document.getElementById("smoker").value = "Yes";
            document.getElementById("day").value = "Sun";
            document.getElementById("time").value = "Dinner";
            document.getElementById("size").value = 2;
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Restaurant Tip Predictor</h1>
        <p class="subtitle">
            Estimate the expected tip using a KNN regression model trained on the Tips dataset.
        </p>

        <form method="POST">
            <div class="field">
                <label for="total_bill">Total Bill</label>
                <input
                    id="total_bill"
                    type="number"
                    step="0.01"
                    min="0"
                    name="total_bill"
                    value="{{ input_values.total_bill }}"
                />
                <span class="hint">Amount of the bill (e.g., 50.00)</span>
            </div>

            <div class="field">
                <label for="sex">Sex</label>
                <select id="sex" name="sex">
                    <option value="Male" {% if input_values.sex == 'Male' %}selected{% endif %}>Male</option>
                    <option value="Female" {% if input_values.sex == 'Female' %}selected{% endif %}>Female</option>
                </select>
            </div>

            <div class="field">
                <label for="smoker">Smoker</label>
                <select id="smoker" name="smoker">
                    <option value="No" {% if input_values.smoker == 'No' %}selected{% endif %}>No</option>
                    <option value="Yes" {% if input_values.smoker == 'Yes' %}selected{% endif %}>Yes</option>
                </select>
            </div>

            <div class="field">
                <label for="day">Day</label>
                <select id="day" name="day">
                    <option value="Thur" {% if input_values.day == 'Thur' %}selected{% endif %}>Thursday</option>
                    <option value="Fri"  {% if input_values.day == 'Fri'  %}selected{% endif %}>Friday</option>
                    <option value="Sat"  {% if input_values.day == 'Sat'  %}selected{% endif %}>Saturday</option>
                    <option value="Sun"  {% if input_values.day == 'Sun'  %}selected{% endif %}>Sunday</option>
                </select>
            </div>

            <div class="field">
                <label for="time">Time</label>
                <select id="time" name="time">
                    <option value="Lunch" {% if input_values.time == 'Lunch' %}selected{% endif %}>Lunch</option>
                    <option value="Dinner" {% if input_values.time == 'Dinner' %}selected{% endif %}>Dinner</option>
                </select>
            </div>

            <div class="field">
                <label for="size">Party Size</label>
                <input
                    id="size"
                    type="number"
                    step="1"
                    min="1"
                    name="size"
                    value="{{ input_values.size }}"
                />
                <span class="hint">Number of people at the table</span>
            </div>

            <div class="buttons-row">
                <button type="submit" class="btn-primary">Predict Tip</button>
                <button type="button" class="btn-secondary" onclick="fillSimpleExample()">Simple example</button>
                <button type="button" class="btn-secondary" onclick="fillBusyTable()">Busy table example</button>
            </div>
        </form>

        <div class="result-section">
            <div class="section-title">Result</div>
            <div class="result-card">
                {% if predicted_tip is not none %}
                    <div class="tip-pill">
                        <span>Predicted tip:</span>
                        <span class="tip-number">${{ "%.2f"|format(predicted_tip) }}</span>
                        {% if tip_percent is not none %}
                            <span>({{ tip_percent }}% of bill)</span>
                        {% endif %}
                    </div>

                    <div class="plot-container">
                        <div id="tip-chart" style="width:100%;max-width:480px;height:260px;"></div>
                    </div>

                    <p class="note">
                        Prediction generated by a KNN regression model trained on the classic Tips dataset.
                        Values are approximate and for demo/educational use only.
                    </p>
                {% else %}
                    <p class="note">
                        No prediction yet. Enter some values above and click <strong>Predict Tip</strong>.
                    </p>
                {% endif %}
            </div>
        </div>
    </div>

    {% if predicted_tip is not none %}
    <script>
        // Pass values from Flask into JS
        var totalBill = {{ input_values.total_bill | default(0) }};
        var predictedTip = {{ predicted_tip | default(0) }};
        var tipPercent = {{ tip_percent | default(0) }};

        var data = [{
            type: "bar",
            x: ["Total bill", "Predicted tip"],
            y: [totalBill, predictedTip],
            text: [
                "$" + totalBill.toFixed(2),
                "$" + predictedTip.toFixed(2) + " (" + tipPercent.toFixed(2) + "%)"
            ],
            textposition: "auto"
        }];

        var layout = {
            title: "Bill vs Predicted Tip",
            yaxis: { title: "Amount ($)" },
            margin: { t: 40, r: 20, l: 50, b: 40 },
            paper_bgcolor: "rgba(0,0,0,0)",
            plot_bgcolor: "rgba(0,0,0,0)",
            font: { color: "#e5e7eb" }
        };

        Plotly.newPlot("tip-chart", data, layout, {displayModeBar: false});
    </script>
    {% endif %}
</body>
</html>
